<!-- Image Upload Component -->
<div class="w-full">
  <!-- Current Image Preview -->
  @if (currentImageUrl) {
    <div class="mb-4">
      <img [src]="currentImageUrl" alt="Current image" class="w-full h-48 object-cover rounded-lg border">
    </div>
  }

  <!-- Drag and Drop Area -->
  <div 
    class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center transition-colors duration-200 cursor-pointer hover:border-orange-400 hover:bg-orange-50"
    [class.border-orange-400]="isDragOver"
    [class.bg-orange-50]="isDragOver"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="fileInput.click()">
    
    <!-- Upload Icon -->
    <div class="mb-4">
      <svg class="w-12 h-12 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
      </svg>
    </div>
    
    <!-- Upload Text -->
    <div class="space-y-2">
      <h3 class="text-lg font-semibold text-gray-700">
        {{ selectedFile ? 'File Selected: ' + selectedFile.name : 'Upload Product Image' }}
      </h3>
      <p class="text-gray-500">
        Drag and drop your image here, or click to browse
      </p>
      <p class="text-sm text-gray-400">
        Supports: PNG, JPG, JPEG, AVIF (Max: 5MB)
      </p>
    </div>
  </div>

  <!-- Hidden File Input -->
  <input 
    #fileInput
    type="file" 
    class="hidden" 
    accept="image/png,image/jpeg,image/jpg"
    (change)="onFileSelected($event)">

  <!-- Upload Button -->
  @if (selectedFile) {
    <div class="mt-4 flex gap-3">
      <button 
        class="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-3 px-6 rounded-lg font-semibold transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        [disabled]="isUploading"
        (click)="uploadImage()">
        @if (isUploading) {
          <span class="flex items-center justify-center gap-2">
            <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
            Uploading...
          </span>
        } @else {
          Upload Image
        }
      </button>
      
      <button 
        class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200"
        (click)="clearSelection()">
        Cancel
      </button>
    </div>
  }

  <!-- Upload Progress -->
  @if (isUploading) {
    <div class="mt-4">
      <div class="bg-gray-200 rounded-full h-2">
        <div class="bg-orange-500 h-2 rounded-full transition-all duration-300" [style.width.%]="uploadProgress"></div>
      </div>
    </div>
  }

  <!-- Error Message -->
  @if (errorMessage) {
    <div class="mt-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg">
      {{ errorMessage }}
    </div>
  }

  <!-- Success Message -->
  @if (successMessage) {
    <div class="mt-4 p-3 bg-green-100 border border-green-300 text-green-700 rounded-lg">
      {{ successMessage }}
    </div>
  }
</div>

<!-- Image Cropper Modal -->
@if (showCropper) {
  <app-image-cropper 
    [isOpen]="showCropper"
    [imageFile]="fileForCropping"
    (imageCropped)="onImageCropped($event)"
    (cancelled)="onCropperCancelled()">
  </app-image-cropper>
}
